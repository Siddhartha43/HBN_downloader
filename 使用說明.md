# EEG檔案自動下載器 - 使用說明

## 概述

這個Python腳本可以自動從NAS路徑 `/mnt/left/home/2025/eegimage/HBN-EEG` 下載指定的EEG檔案到本機資料夾。

## 檔案說明

- `eeg_downloader.py` - 主要下載腳本
- `simple_download.py` - 簡化版本，已包含您提供的資料
- `sample_data.txt` - 範例資料檔案
- `requirements.txt` - Python依賴套件
- `README.md` - 英文說明文件

## 快速開始

### 1. 安裝依賴
```bash
pip install -r requirements.txt
```

### 2. 直接執行（推薦）
```bash
python simple_download.py
```

這會下載您提供的所有39個檔案到 `my_eeg_files` 資料夾。

### 3. 使用自訂資料
```bash
python eeg_downloader.py --input your_data.txt --output ./your_folder
```

## 資料格式

輸入資料應為三欄格式，以Tab分隔：
```
受試者ID	回合編號	任務名稱
sub-NDARAU044FP6	R10	ThePresent
sub-NDARCA851LUG	R10	DiaryOfAWimpyKid
```

## 支援的檔案格式

- **Excel檔案** (.xlsx, .xls)
- **CSV檔案** (.csv)
- **TSV檔案** (.tsv)
- **純文字檔案** (.txt)

## 檔案路徑結構

腳本會根據以下結構在NAS上尋找檔案：
```
/mnt/left/home/2025/eegimage/HBN-EEG/
├── HBN_EEG_R10/
│   └── sub-NDARAU044FP6/
│       └── eeg/
│           └── sub-NDARAU044FP6_task-ThePresent_eeg.set
└── HBN_EEG_R11/
    └── ...
```

## 輸出結果

- 下載的檔案會儲存在指定的輸出目錄中
- 檔案命名格式：`{受試者ID}_R{回合編號}_{任務名稱}.set`
- 日誌檔案：`eeg_download.log`

## 測試結果

使用您提供的資料進行測試：
- **成功下載**：39個檔案
- **失敗下載**：0個檔案
- **總計**：39個檔案

**修正內容**：
- 正確處理檔案命名規則，支援 `run-1`, `run-2` 等後綴
- `contrastChangeDetection_1` → `contrastChangeDetection_run-1_eeg.set`
- `surroundSupp_1` → `surroundSupp_run-1_eeg.set`

## 常見問題

### Q: 為什麼有些檔案下載失敗？
A: 可能是因為：
- 受試者ID在NAS上不存在
- 特定任務的檔案不存在
- 檔案路徑結構與預期不同
- 檔案命名規則不正確（例如：`contrastChangeDetection_1` 對應 `contrastChangeDetection_run-1_eeg.set`）

### Q: 檔案命名規則是什麼？
A: 腳本會自動處理以下命名轉換：
- `contrastChangeDetection_1` → `contrastChangeDetection_run-1_eeg.set`
- `surroundSupp_1` → `surroundSupp_run-1_eeg.set`
- `ThePresent` → `ThePresent_eeg.set`（一般任務）

### Q: 如何檢查哪些檔案存在？
A: 可以修改腳本添加檢查功能，或直接查看NAS上的資料夾結構。

### Q: 可以下載其他格式的檔案嗎？
A: 目前只下載 `.set` 檔案，但可以修改腳本下載相關的 `.json` 和 `.tsv` 檔案。

## 進階使用

### 自訂NAS路徑
```bash
python eeg_downloader.py --nas-path /your/nas/path --input data.txt
```

### 直接輸入文字
```bash
python eeg_downloader.py --text "sub-NDARAU044FP6	R10	ThePresent" --output ./test
```

### 批次處理多個檔案
```bash
python eeg_downloader.py --input data1.txt --output ./batch1
python eeg_downloader.py --input data2.txt --output ./batch2
```

## 技術細節

- 使用 `shutil.copy2()` 進行檔案複製
- 支援詳細的日誌記錄
- 自動建立輸出目錄
- 錯誤處理和統計報告
